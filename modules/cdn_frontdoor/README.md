# Module: Azure CDN Front Door

Front solution with an Azure front door (optional)

- Deploy Azure Front Door CDN.
- Setup a custom domain with AFD managed certificate.
- Optionally create an Azure DNS Zone or use an existing one for the custom domain. (e.g PrivateGPT.mydomain.com)
- Create CNAME and TXT record in the custom DNS zone.
- Setup and apply AFD WAF policy for the front door with allowed IPs custom rule. (Optional)

<!-- BEGIN_TF_DOCS -->
## Requirements

No requirements.

## Providers

| Name | Version |
|------|---------|
| <a name="provider_azurerm"></a> [azurerm](#provider\_azurerm) | n/a |

## Modules

No modules.

## Resources

| Name | Type |
|------|------|
| [azurerm_cdn_frontdoor_custom_domain.gpt](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/cdn_frontdoor_custom_domain) | resource |
| [azurerm_cdn_frontdoor_endpoint.gpt](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/cdn_frontdoor_endpoint) | resource |
| [azurerm_cdn_frontdoor_firewall_policy.gpt](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/cdn_frontdoor_firewall_policy) | resource |
| [azurerm_cdn_frontdoor_origin.gpt](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/cdn_frontdoor_origin) | resource |
| [azurerm_cdn_frontdoor_origin_group.gpt](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/cdn_frontdoor_origin_group) | resource |
| [azurerm_cdn_frontdoor_profile.gpt](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/cdn_frontdoor_profile) | resource |
| [azurerm_cdn_frontdoor_route.gpt](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/cdn_frontdoor_route) | resource |
| [azurerm_cdn_frontdoor_security_policy.gpt](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/cdn_frontdoor_security_policy) | resource |
| [azurerm_dns_cname_record.gpt](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/dns_cname_record) | resource |
| [azurerm_dns_txt_record.gpt](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/dns_txt_record) | resource |
| [azurerm_dns_zone.gpt](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/dns_zone) | resource |
| [azurerm_dns_zone.gpt](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/data-sources/dns_zone) | data source |

## Inputs

| Name | Description | Type | Default | Required |
|------|-------------|------|---------|:--------:|
| <a name="input_cdn_endpoint"></a> [cdn\_endpoint](#input\_cdn\_endpoint) | typp = object({<br>      name    = (Required) The name of the CDN endpoint to create.<br>      enabled = (Optional) Is the CDN endpoint enabled? Defaults to `true`.<br>    }) | <pre>object({<br>    name    = string<br>    enabled = optional(bool, true)<br>  })</pre> | <pre>{<br>  "enabled": true,<br>  "name": "PrivateGPT"<br>}</pre> | no |
| <a name="input_cdn_firewall_policy"></a> [cdn\_firewall\_policy](#input\_cdn\_firewall\_policy) | The CDN firewall policies to create. | <pre>object({<br>    create_waf                        = bool<br>    name                              = string<br>    enabled                           = optional(bool, true)<br>    mode                              = optional(string, "Prevention")<br>    redirect_url                      = optional(string)<br>    custom_block_response_status_code = optional(number, 403)<br>    custom_block_response_body        = optional(string)<br>    custom_rules = optional(list(object({<br>      name                           = string<br>      action                         = string<br>      enabled                        = optional(bool, true)<br>      priority                       = number<br>      type                           = string<br>      rate_limit_duration_in_minutes = optional(number, 1)<br>      rate_limit_threshold           = optional(number, 10)<br>      match_conditions = list(object({<br>        match_variable     = string<br>        match_values       = list(string)<br>        operator           = string<br>        selector           = optional(string)<br>        negation_condition = optional(bool)<br>        transforms         = optional(list(string))<br>      }))<br>    })))<br>  })</pre> | <pre>{<br>  "create_waf": true,<br>  "custom_block_response_body": "WW91ciByZXF1ZXN0IGhhcyBiZWVuIGJsb2NrZWQu",<br>  "custom_block_response_status_code": 403,<br>  "custom_rules": [<br>    {<br>      "action": "Block",<br>      "enabled": true,<br>      "match_conditions": [<br>        {<br>          "match_values": [<br>            "10.0.1.0/24",<br>            "10.0.2.0/24"<br>          ],<br>          "match_variable": "RemoteAddr",<br>          "negation_condition": null,<br>          "operator": "IPMatch",<br>          "selector": null,<br>          "transforms": []<br>        }<br>      ],<br>      "name": "PrivateGPTFirewallPolicyCustomRule",<br>      "priority": 100,<br>      "rate_limit_duration_in_minutes": 1,<br>      "rate_limit_threshold": 10,<br>      "type": "MatchRule"<br>    }<br>  ],<br>  "enabled": true,<br>  "mode": "Prevention",<br>  "name": "PrivateGPTFirewallPolicy",<br>  "redirect_url": null<br>}</pre> | no |
| <a name="input_cdn_gpt_origin"></a> [cdn\_gpt\_origin](#input\_cdn\_gpt\_origin) | type = object({<br>  name                           = (Required) The name which should be used for this Front Door Origin. Changing this forces a new Front Door Origin to be created.<br>  origin\_group\_name              = (Required) The name of the CDN origin group to associate this origin with.<br>  enabled                        = (Optional) Is the CDN origin enabled? Defaults to `true`.<br>  certificate\_name\_check\_enabled = (Required) Specifies whether certificate name checks are enabled for this origin. Defaults to `true`.<br>  host\_name                      = (Required) The IPv4 address, IPv6 address or Domain name of the Origin. (e.g. mysite.example.com)<br>  http\_port                      = (Optional) The HTTP port of the origin. (e.g. 80)<br>  https\_port                     = (Optional) The HTTPS port of the origin. (e.g. 443)<br>  origin\_host\_header             = (Optional) The origin host header. (e.g. www.mysite.example.com)<br>  priority                       = (Optional) The priority of the origin. (e.g. 1)<br>  weight                         = (Optional) The weight of the origin. (e.g. 1000)<br>}) | <pre>object({<br>    name                           = string<br>    origin_group_name              = string<br>    enabled                        = optional(bool, true)<br>    certificate_name_check_enabled = optional(bool, true)<br>    host_name                      = string<br>    http_port                      = optional(number, 80)<br>    https_port                     = optional(number, 443)<br>    origin_host_header             = optional(string, "www.mysite.example.com")<br>    priority                       = optional(number, 1)<br>    weight                         = optional(number, 1000)<br>  })</pre> | <pre>{<br>  "certificate_name_check_enabled": true,<br>  "enabled": true,<br>  "host_name": "mysite.example.com",<br>  "http_port": 80,<br>  "https_port": 443,<br>  "name": "PrivateGPTOrigin",<br>  "origin_group_name": "PrivateGPTOriginGroup",<br>  "origin_host_header": "www.mysite.example.com",<br>  "priority": 1,<br>  "weight": 1000<br>}</pre> | no |
| <a name="input_cdn_origin_groups"></a> [cdn\_origin\_groups](#input\_cdn\_origin\_groups) | type = list(object({<br>  name                                                      = (Required) The name of the CDN origin group to create.<br>  session\_affinity\_enabled                                  = (Optional) Is session affinity enabled? Defaults to `false`.<br>  restore\_traffic\_time\_to\_healed\_or\_new\_endpoint\_in\_minutes = (Optional) The time in minutes to restore traffic to a healed or new endpoint. Defaults to `5`.<br>  health\_probe = (Optional) The health probe settings.<br>  type = object({<br>    interval\_in\_seconds = (Optional) The interval in seconds between health probes. Defaults to `100`.<br>    path                = (Optional) The path to use for health probes. Defaults to `/`.<br>    protocol            = (Optional) The protocol to use for health probes. Possible values include 'Http' and 'Https'. Defaults to `Http`.<br>    request\_type        = (Optional) The request type to use for health probes. Possible values include 'GET', 'HEAD', and 'OPTIONS'. Defaults to `HEAD`.<br>  }))<br>  load\_balancing = (Optional) The load balancing settings.<br>  type = object({<br>    additional\_latency\_in\_milliseconds = (Optional) The additional latency in milliseconds for probes to fall into the lowest latency bucket. Defaults to `50`.<br>    sample\_size                        = (Optional) The number of samples to take for load balancing decisions. Defaults to `4`.<br>    successful\_samples\_required        = (Optional) The number of samples within the sample period that must succeed. Defaults to `3`.<br>  }))<br>})) | <pre>list(object({<br>    name                                                      = string<br>    session_affinity_enabled                                  = optional(bool, false)<br>    restore_traffic_time_to_healed_or_new_endpoint_in_minutes = optional(number, 5)<br>    health_probe = optional(object({<br>      interval_in_seconds = optional(number, 100)<br>      path                = optional(string, "/")<br>      protocol            = optional(string, "Http")<br>      request_type        = optional(string, "HEAD")<br>    }))<br>    load_balancing = optional(object({<br>      additional_latency_in_milliseconds = optional(number, 50)<br>      sample_size                        = optional(number, 4)<br>      successful_samples_required        = optional(number, 3)<br>    }))<br>  }))</pre> | <pre>[<br>  {<br>    "health_probe": {<br>      "interval_in_seconds": 100,<br>      "path": "/",<br>      "protocol": "Http",<br>      "request_type": "HEAD"<br>    },<br>    "load_balancing": {<br>      "additional_latency_in_milliseconds": 50,<br>      "sample_size": 4,<br>      "successful_samples_required": 3<br>    },<br>    "name": "PrivateGPTOriginGroup",<br>    "restore_traffic_time_to_healed_or_new_endpoint_in_minutes": 5,<br>    "session_affinity_enabled": false<br>  }<br>]</pre> | no |
| <a name="input_cdn_profile_name"></a> [cdn\_profile\_name](#input\_cdn\_profile\_name) | The name of the CDN profile to create. | `string` | `"example-cdn-profile"` | no |
| <a name="input_cdn_resource_group_name"></a> [cdn\_resource\_group\_name](#input\_cdn\_resource\_group\_name) | Name of the resource group to create the CDN Front Door solution resources in. | `string` | n/a | yes |
| <a name="input_cdn_route"></a> [cdn\_route](#input\_cdn\_route) | type = object({<br>  name                           = (Required) The name of the CDN route to create.<br>  enabled                        = (Optional) Is the CDN route enabled? Defaults to `true`.<br>  forwarding\_protocol            = (Optional) The protocol this rule will use when forwarding traffic to backends. Possible values include `MatchRequest`, `HttpOnly` and `HttpsOnly`. Defaults to `HttpsOnly`.<br>  https\_redirect\_enabled         = (Optional) Is HTTPS redirect enabled? Defaults to `false`.<br>  patterns\_to\_match              = (Optional) The list of patterns to match for this rule. Defaults to `["/*"]`.<br>  supported\_protocols            = (Optional) The list of supported protocols for this rule. Defaults to `["Http", "Https"]`.<br>  cdn\_frontdoor\_origin\_path      = (Optional) The path to use when forwarding traffic to backends. Defaults to `null`.<br>  cdn\_frontdoor\_rule\_set\_ids     = (Optional) The list of rule set IDs to associate with this rule. Defaults to `null`.<br>  link\_to\_default\_domain         = (Optional) Is the CDN route linked to the default domain? Defaults to `false`.<br>  cache = (Optional) The CDN route cache settings.<br>  type = object({<br>    query\_string\_caching\_behavior = (Required) The query string caching behavior. Possible values include 'IgnoreQueryString', 'BypassCaching', 'UseQueryString', and 'NotSet'. Defaults to 'IgnoreQueryString'.<br>    query\_strings                 = (Optional) The list of query strings to include or exclude from caching. Defaults to `[]`.<br>    compression\_enabled           = (Required) Is compression enabled? Defaults to `false`.<br>    content\_types\_to\_compress     = (Optional) The list of content types to compress. Defaults to `[]`.<br>  })<br>}) | <pre>object({<br>    name                       = string<br>    enabled                    = optional(bool, true)<br>    forwarding_protocol        = optional(string, "HttpsOnly")<br>    https_redirect_enabled     = optional(bool, false)<br>    patterns_to_match          = optional(list(string), ["/*"])<br>    supported_protocols        = optional(list(string), ["Http", "Https"])<br>    cdn_frontdoor_origin_path  = optional(string, null)<br>    cdn_frontdoor_rule_set_ids = optional(list(string), null)<br>    link_to_default_domain     = optional(bool, false)<br>    cache = optional(object({<br>      query_string_caching_behavior = string<br>      query_strings                 = optional(list(string), [])<br>      compression_enabled           = bool<br>      content_types_to_compress     = optional(list(string), [])<br>    }))<br>  })</pre> | <pre>{<br>  "cache": {<br>    "compression_enabled": false,<br>    "content_types_to_compress": [],<br>    "query_string_caching_behavior": "IgnoreQueryString",<br>    "query_strings": []<br>  },<br>  "cdn_frontdoor_origin_path": null,<br>  "cdn_frontdoor_rule_set_ids": null,<br>  "enabled": true,<br>  "forwarding_protocol": "HttpsOnly",<br>  "https_redirect_enabled": false,<br>  "link_to_default_domain": false,<br>  "name": "PrivateGPTRoute",<br>  "patterns_to_match": [<br>    "/*"<br>  ],<br>  "supported_protocols": [<br>    "Http",<br>    "Https"<br>  ]<br>}</pre> | no |
| <a name="input_cdn_security_policy"></a> [cdn\_security\_policy](#input\_cdn\_security\_policy) | type = object({<br>  name                 = (Required) The name of the CDN security policy to create.<br>  patterns\_to\_match    = (Required) The list of patterns to match for this policy. Defaults to `["/*"]`.<br>}) | <pre>object({<br>    name              = string<br>    patterns_to_match = list(string)<br>  })</pre> | <pre>{<br>  "name": "PrivateGPTSecurityPolicy",<br>  "patterns_to_match": [<br>    "/*"<br>  ]<br>}</pre> | no |
| <a name="input_cdn_sku_name"></a> [cdn\_sku\_name](#input\_cdn\_sku\_name) | Specifies the SKU for the CDN Front Door Profile. Possible values include 'Standard\_AzureFrontDoor' and 'Premium\_AzureFrontDoor'. | `string` | `"Standard_AzureFrontDoor"` | no |
| <a name="input_create_dns_zone"></a> [create\_dns\_zone](#input\_create\_dns\_zone) | Create a DNS zone for the CDN profile. If set to false, an existing DNS zone must be provided. | `bool` | `false` | no |
| <a name="input_custom_domain_config"></a> [custom\_domain\_config](#input\_custom\_domain\_config) | type = object({<br>  zone\_name = (Required) The name of the DNS zone to create the CNAME and TXT record in for the CDN Front Door Custom domain.<br>  host\_name = (Required) The host name of the DNS record to create. (e.g. Contoso)<br>  ttl       = (Optional) The TTL of the DNS record to create. (e.g. 3600)<br>  tls       = optional(list(object({<br>    certificate\_type    = (Optional) Defines the source of the SSL certificate. Possible values include 'CustomerCertificate' and 'ManagedCertificate'. Defaults to 'ManagedCertificate'.<br>    NOTE: It may take up to 15 minutes for the Front Door Service to validate the state and Domain ownership of the Custom Domain.<br>    minimum\_tls\_version = (Optional) TLS protocol version that will be used for Https. Possible values include TLS10 and TLS12. Defaults to TLS12.<br>  }))))<br>}) | <pre>object({<br>    zone_name = string<br>    host_name = string<br>    ttl       = optional(number, 3600)<br>    tls = optional(list(object({<br>      certificate_type    = optional(string, "ManagedCertificate")<br>      minimum_tls_version = optional(string, "TLS12")<br>    })))<br>  })</pre> | <pre>{<br>  "host_name": "PrivateGPT",<br>  "tls": [<br>    {<br>      "certificate_type": "ManagedCertificate",<br>      "minimum_tls_version": "TLS12"<br>    }<br>  ],<br>  "ttl": 3600,<br>  "zone_name": "mydomain7335.com"<br>}</pre> | no |
| <a name="input_dns_resource_group_name"></a> [dns\_resource\_group\_name](#input\_dns\_resource\_group\_name) | The name of the resource group to create the DNS zone in / or where the existing zone is hosted. | `string` | n/a | yes |
| <a name="input_tags"></a> [tags](#input\_tags) | A map of key value pairs that is used to tag resources created. | `map(string)` | `{}` | no |

## Outputs

No outputs.
<!-- END_TF_DOCS -->